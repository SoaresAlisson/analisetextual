# Análise de Redes Sociais

O R possui diversos pacotes para análise de rede, como o [`igraph`](https://igraph.org/r/), 
[`statnet`](https://cran.r-project.org/web/packages/statnet/index.html),
e do tidyverse temos 
[`tydygraph`](https://tidygraph.data-imaginist.com/) e
[`ggraph`](https://cran.r-project.org/web/packages/ggraph/ggraph.pdf).

## O pacote Igraph

Instalando o pacote `igraph`:

```{r, eval=FALSE, results='hide', collapse = TRUE}
install.packages("igraph") # instalando o pacote
```

chamando o pacote já instalado
```{r, results='hide', collapse = TRUE}
library(igraph) # chamando o pacote já instalado
```

<!-- A partir da ajuda do `igraph` --- no caso, digitando ` ?igraph.plotting` no console do R, e correndo até o final da ajuda ---  temos alguns exemplos de grafos com o Igraph. Por exemplo, construindo um anel: 

```{r}
 g <- make_ring(10)
     g$layout <- layout_in_circle
     plot(g)
```
-->

É possível ainda plotar com os comandos `tkplot(g)` e `rglplot(g)`. Rode no seu console e veja a diferença nos gráficos. Mas vamos a algo mais prático, pegando o famoso poema de Drummond:

> "João amava Teresa que amava Raimundo que amava Maria que amava Joaquim que amava Lili que não amava ninguém"

E o transformando em um grafo (os "gráficos" em análise de rede recebem este nome):

```{r}
library(igraph) 
g <- graph.empty(directed=TRUE) # "directed" implica distinguir entre "de" e "para" na relação entre os nós.

#  Adicionando os vértices. 
g <- g + vertex("João") 
g <- g + vertex("Teresa") 
g <- g + vertex("Raimundo") 
g <- g + vertex("Maria") 
g <- g + vertex("Joaquim") 
g <- g + vertex("Lili") 

#  Especificando as relações entres os vértices, os edges
g <- g + edges("João", "Teresa")
g <- g + edges("Teresa", "Raimundo")
g <- g + edges("Raimundo", "Maria")
g <- g + edges("Maria", "Joaquim")
g <- g + edges("Joaquim", "Lili")

plot.igraph(g) # plotando o grafo
```

Neste caso, poderíamos ter feito este mesmo gráfico com código mais compacto:

```{r}
library(igraph) 
g <- graph.empty(directed=TRUE) 

#  Adicionando os vértices. 
g <- g + vertex(c("João", "Teresa", "Raimundo", "Maria", "Joaquim", "Lili"))

#  Adicionando os edges em pares
g <- g + edges(c("João", "Teresa", "Teresa", "Raimundo", "Raimundo", "Maria","Maria", "Joaquim","Joaquim", "Lili"))

plot.igraph(g)
```

Se o grafo sobe ou desce, pouco importa para nós aqui, importa as pessoas e as relações entre elas.
Repare que os edges são entendidos aos pares. Se fizéssemos um vetor sem as devidas repetições, teríamos um gráfico errado das relações:

```{r}
g <- graph.empty(directed=TRUE) 
g <- g + vertex(c("João", "Teresa", "Raimundo", "Maria", "Joaquim", "Lili"))
g <- g + edges(c("João", "Teresa", "Raimundo", "Maria","Joaquim", "Lili"))
plot.igraph(g)
```

Ou de modo mais econômico ainda: 

```{r}
g <- graph.formula(
    João --+ Teresa --+ Raimundo --+ Maria --+ Joaquim --+ Lili
)
plot(g)
```

<!-- Vamos a outro exemplo: -->

<!-- ```{r} -->
<!-- library(igraph)  -->
<!-- g <- graph.empty(directed=TRUE)  -->

<!-- #  manually add our data.  -->
<!-- g <- g + vertex("Elizabeth II")  -->
<!-- g <- g + vertex("Philip")  -->
<!-- g <- g + vertex("Charles")  -->
<!-- g <- g + vertex("Diana")  -->
<!-- g <- g + vertex("William")  -->
<!-- g <- g + vertex("Harry")  -->
<!-- g <- g + vertex("Catherine")  -->
<!-- g <- g + vertex("George") -->

<!-- g <- g + edges("Elizabeth II", "Charles") -->
<!-- g <- g + edges("Philip", "Charles") -->
<!-- g <- g + edges("Charles", "William") -->
<!-- g <- g + edges("Diana", "William") -->
<!-- g <- g + edges("Charles", "Harry") -->
<!-- g <- g + edges("Diana", "Harry") -->
<!-- g <- g + edges("William", "George") -->
<!-- g <- g + edges("Catherine", "George")  -->

<!-- g -->
<!-- ``` 
 ```{r}
 plot.igraph(g)
 ```

-->

### Clusterização

__Em elaboração__

## Os pacotes `ggraph` e `tidygraph` . Construindo grafos com o `tidyverse`.

O pacote [ggraph](https://ggraph.data-imaginist.com/) é um pacote elaborado por Thomas Lin Pedersen, o mesmo do ggplot2, e pretende ser uma extensão deste, usando a mesma gramática de gráficos, o que nos dá grande flexibiidade visual. Com o ggraph é possível construir graficamente redes, mas ele vai além dos grafos, construindo também dendogramas, diferentes tipos de árvores, matrizes, gráficos hierárquicos, diagrama de arc, sunburst, etc.
Para inserir os dados no ggraph, é necessário colocá-lo no formato "tidy" do "tidyverse", e fazemos isso com o pacote `tidygraph`:

Para instalar, usamos os comandos:
```{r, eval=FALSE, results='hide',collapse = TRUE}
install.packages('ggraph')
install.packages('tidygraph')
```


Carregando os pacotes

```{r,  results='hide', collapse = TRUE}
library(ggraph) 
library(tidygraph) 
```

<!-- > ggraph is an extension of ggplot2 aimed at supporting relational data structures such as networks, graphs, and trees. While it builds upon the foundation of ggplot2 and its API it comes with its own self-contained set of geoms, facets, etc., as well as adding the concept of layouts to the grammar. -->



<!-- install.packages('ggraph') #instalando # instalando o pacote -->


Seguindo o exemplo na página do criador do GGraph
[Thomas Lin Pedersen](https://github.com/thomasp85/ggraph),
vamos usar o dataset `highschool` do `ggraph`, que contém dados sobre a evolução da amizade entre garotos numa escola do ensino médio no Illinois, nos anos de 1957 e 1958, que responderam à pergunta:
"Com que colegas desta escola você anda mais frequentemente?". Esta pesquisa apareceu originalmente nos livros "Introduction to Mathematical Sociology" e "The Adolescent Society", ambos do sociólogo James Coleman.
<!-- - Coleman, J. S. Introduction to Mathematical Sociology. New York: Free Press, pp.450-453. -->
<!-- - Coleman, J. S. The Adolescent Society (New York:The Free Press of Glenco e,1961). -->
Para obter mais informações sobre este dataset, basta digitar no console: `help(highschool)`.


```{r, collapse = TRUE}
str(highschool) # observando a estrutura do data frame
```


```{r, collapse = TRUE}
head(highschool,10) # observado as primeiras linhas do data frame
```
Vemos que há na coluna 1 de ("from") pessoa número X para ("to") para pessoa Y no ano ("year"). Assim, a pessoa 1 teve contato com as pessoas 14, 15, 21, 54 e 55 em 1957. A pessoa 2 teve contato com as pessoas 21 e 22, e assim por diante.
Vamos preparar os dados para plotar o grafo com ggraph. Antes, é necessário colocá-lo no formato "tidy" do "tidyverse", e fazemos isso com o pacote `tidygraph`.
A função `as_tbl_graph()` do pacote `tidygraph` funciona como a função `grouped_df()`, que agrupa nós (nodes) e arestas (edges).

```{r, collapse = TRUE}
as_tbl_graph(highschool)
```
Vamos criar uma lista chamada "grafo", adicionando um campo novo com `mutate()`, de nome "Popularidade" e que vai medir a centralidade de grau através da função `centrality_degree()` do tidygraph. Centralidade de grau é a medida mais simples de centralidade, que  conta o número de conexões, as arestas ("edges") de cada nó.

<!-- mode: How should edges be followed. Ignored for undirected graphs. pode ser também 'out' -->

```{r, collapse = TRUE}
grafo <- as_tbl_graph(highschool) %>% 
    mutate(Popularidade = centrality_degree(mode = 'in'))
grafo
```

Plotando o grafo:


```{r}
ggraph(grafo, layout = 'kk') + 
    geom_edge_fan(aes(colour = stat(index)), show.legend = FALSE) + 
    geom_node_point(aes(size = Popularidade, colour= Popularidade), show.legend = TRUE) +
    scale_colour_gradient(low = "steelblue", high = "black") +
    facet_edges(~year) + 
    theme_graph(foreground = 'steelblue', fg_text_colour = 'yellow') +
    labs(title = "Evolução da amizade entre adolescentes de uma escola no Illinóis", caption = "Fonte: Elaboração própria a partir dos dados de Coleman(1961)")
```

- `layout` define como os nós serão alocados. O layout do ggraph possui os mesmos do igraph e outros mais como, hive plots, treemaps e circle packing. `kk` indica que está sendo usado o algortimo Kamada-Kawai para dispersar os nós para facilitar nossa visualização.
<!-- The Nodes are the connected entities in the relational structure. These can be plotted using the geom_node_*() family of geoms. Some node geoms make more sense for certain layouts, e.g. geom_node_tile() for treemaps and icicle plots, while others are more general purpose, e.g. geom_node_point(). -->
<!-- The Edges are the connections between the entities in the relational structure. These can be visualized using the geom_edge_*() family of geoms that contain a lot of different edge types for different scenarios. Sometimes the edges are implied by the layout (e.g. with treemaps) and need not be plotted, but often some sort of line is warranted. -->
- `geom_edge_fan()` desenha os laços de modo curvo. Há diversas outras opções possíveis neste caso, como:
`geom_edge_arc`, `geom_edge_bend`, `geom_edge_diagonal`,`geom_edge_elbow`, `geom_edge_fan`, `geom_edge_hive`, `geom_edge_link`, `geom_edge_parallel`. <!-- Já `alpha` indica transparência. -->
`colour` indica que a intensidade das ligações será por um gradiente de cor,
`stat()` indica que segue ali uma informação estatística.
- `geom_node_point()` msostra os nós como pontos/círculos e permite que sejam plotados em diferentes tamanhos, cores e formas em `aes()`. `size = Popularidade` indica que o tamanho dos nós é controlado pela variável "Popularidade" que criamos. `colour = Popularidade` indica que além do tamanho, a cor também vaira conforme a popularidade. Para mais opções, digite `?geom_node_point()` no console ou consulte a [documentação do ggraph](https://cran.r-project.org/web/packages/ggraph/ggraph.pdf).
- `scale_colour_gradient(low = "steelblue", high = "black")` é opcional, podendo ser retirada. Especifica o gradiente de cores do comando anterior (no caso, nós), qual o valor mais baixo até o mais elevado. 
- `facet_edges()`  função de "faceting", de criar facetas, gráficos multiplos, e o símbolo de til `~` seguido de `year` indica que o critério aqui são as categorias dentro de ano, que no caso, são 1957 e 1958. Os nós são repetidos em cada painel.
<!-- Create small multiples based on edge attributes. Nodes are repeated in every panel.  -->
<!-- `facet_graph` Create a grid of small multiples by node and/or edge attribute -->
<!-- `facet_nodes` Create small multiples based on node attributes -->
- `theme_graph` especifica as cores das legendas nas facetas
- `labs(title = "` indica o título e `caption` o rodapé.


<!-- |geom_edge_bend || -->
**Veja também**

- [cheatsheet/folha de dicas do ggraph](https://ggraph.data-imaginist.com/reference/index.html)
- Para ver os diferentes layouts possíves do ggraph e seus respectivos códigos, para além dos grafos [clique aqui](https://ggraph.data-imaginist.com/articles/Layouts.html)




_CAPÍTULO A SER EXPANDIDO_




## Redes de palavras
_A ser elaborado_

## Redes de citação

<!-- 6.3 Citation Networks -->
_A ser elaborado_

## Gráfico de centralidade

<!-- 6.4 Graph Centrality -->

_A ser elaborado_

## Comunidades

<!-- 6.5 Graph Communities -->

_A ser elaborado_

## Sugestões de links {#SugestaoLinksredes}
- AQUINO, Jackson A. "Análise de redes sociais",  capítulo 12 de ___. [R para cientistas sociais](http://www.uesc.br/editora/livrosdigitais_20140513/r_cientistas.pdf). Ilhéus, BA: EDITUS, 2014. 157 p. ISBN: 978-85-7455-369-6. (PDF gratuito bem introdutório com R)
- HIGGINS, Silvio S.; RIBEIRO, Antônio Carlos. [Análise de redes em Ciências Sociais](https://repositorio.enap.gov.br/bitstream/1/3337/1/Livro_Analise%20de%20Redes%20em%20Ci%C3%AAncias%20Sociais.pdf). Brasília: ENAP. 2018. 229p. (PDF Gratuito de livro. Bom para aprender os conceitos/teorias básicos de análise de rede).
- [Manual online do ipgraph para R](https://igraph.org/r/doc/); [PDF do Manual do igraph para R](https://igraph.org/r/doc/igraph.pdf) (ambos em inglês)
- [ggraph Documentation](https://cran.r-project.org/web/packages/ggraph/ggraph.pdf) no Cran.
- d’ANDRÉA, Carlos Frederico de Brito. [Pesquisando plataformas online: conceitos e métodos](https://t.co/M6K92IaynT?amp=1). EDUFBA. 2020. 
  - _A obra visa introduzir os Estudos de Plataforma, um campo de estudos que, desde o início da década de 2010, discute as especificidades políticas e materiais das mídias sociais e de outras plataformas online. Datificação, algoritmos, governança e os modelos de negócio das plataformas são algumas das dimensões sintetizadas no livro. De modo didático, o autor apresenta um conjunto de leituras e de experimentações metodológicas conduzidas com um diversificado grupo de colaboradoras(es) no país e no exterior_. (ebook PDF e Epub gratuitos)
- RECUERO, Raquel. [Introdução à análise de redes sociais online](https://repositorio.ufba.br/ri/handle/ri/24759). EDUFBA.2017. 
  - _A Análise de Redes Sociais (ARS) é uma abordagem de pesquisa cuja popularidade tem aumentado nos últimos anos, principalmente, entre os pesquisadores da área de Comunicação. É nesse âmbito que várias obras, entre artigos e livros, vêm surgindo e introduzindo o estudo dessas estruturas a partir da análise de redes e da compreensão da representação dessas redes sociais na internet. Este livro é uma pequena compilação dos principais conceitos e elementos para a compreensão e a aplicação da ARS. É baseado em uma breve apresentação e histórico do paradigma, os principais conceitos, suas métricas e, finalmente, suas formas de representação e visualização_. (ebook PDF e Epub gratuitos).
- LIZARDO Omar; JILBERT Isaac. [Social Networks: An Introduction](http://olizardo.bol.ucla.edu/classes/soc-111/textbook/_book/). 2021. (ebook online)

